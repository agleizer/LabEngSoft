<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Caminho F√°cil ‚Äì Rotas</title>

		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

		<style>
			html,
			body {
				height: 100%;
				margin: 0;
			}

			#map {
				height: 100vh;
				width: 100vw;
			}

			/* --- √≠cones superiores --- */
			.top-icons {
				position: absolute;
				top: 15px;
				right: 15px;
				z-index: 1000;
				display: flex;
				gap: 10px;
			}

			.top-icons button {
				border: none;
				background: white;
				border-radius: 50%;
				width: 42px;
				height: 42px;
				display: flex;
				align-items: center;
				justify-content: center;
				box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
			}

			/* --- sidebar --- */
			#sidebar {
				position: fixed;
				left: -250px;
				top: 0;
				height: 100%;
				width: 250px;
				background: #198754;
				color: white;
				padding-top: 60px;
				transition: left 0.3s ease;
				z-index: 1100;
			}

			#sidebar.active {
				left: 0;
			}

			#sidebar a {
				color: white;
				display: block;
				padding: 12px 20px;
				text-decoration: none;
			}

			#sidebar a:hover {
				background: rgba(255, 255, 255, 0.2);
			}

			/* --- painel de rotas --- */
			.route-panel {
				position: absolute;
				top: 70px;
				left: 50%;
				transform: translateX(-50%);
				z-index: 1000;
				background: white;
				padding: 15px;
				border-radius: 10px;
				width: 90%;
				max-width: 420px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
			}

			.route-panel label {
				font-weight: bold;
			}

			/* --- bot√£o relat√≥rio --- */
			#btnRelatorio {
				position: absolute;
				bottom: 25px;
				left: 50%;
				transform: translateX(-50%);
				z-index: 1000;
			}
		</style>
	</head>

	<body>
		<div id="map"></div>

		<!-- √çcones superiores -->
		<div class="top-icons">
			<button id="menuBtn">‚ò∞</button>
			<button onclick="window.location.href='login.html'">üë§</button>
		</div>

		<!-- Sidebar -->
		<div id="sidebar">
			<a href="index.html">Mapa</a>
			<a href="relatorio.html">Relat√≥rios</a>
			<a href="config.html">Configura√ß√µes</a>
		</div>

		<!-- Painel de rotas -->
		<div class="route-panel">
			<div class="mb-2">
				<label>Origem</label>
				<input type="text" id="origem" class="form-control" placeholder="Digite a origem ou use sua localiza√ß√£o" />
			</div>
			<div class="mb-2">
				<label>Destino</label>
				<input type="text" id="destino" class="form-control" placeholder="Digite o destino" />
			</div>

			<div class="mb-2">
				<label>Filtros de acessibilidade</label><br />
				<div class="form-check">
					<input class="form-check-input" type="checkbox" id="cadeirante" />
					<label class="form-check-label" for="cadeirante">Adequada para cadeirantes</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" id="tatil" />
					<label class="form-check-label" for="t√°til">Presen√ßa de piso t√°til</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" id="largas" />
					<label class="form-check-label" for="largas">Cal√ßadas largas</label>
				</div>
			</div>

			<div class="d-grid">
				<button id="btnRota" class="btn btn-primary">üö∂ Tra√ßar rota</button>
			</div>
		</div>

		<!-- Bot√£o relat√≥rio -->
		<button id="btnRelatorio" class="btn btn-success btn-lg" onclick="window.location.href='relatorio.html'">üìÑ Gerar Relat√≥rio da Regi√£o</button>

		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			const map = L.map("map").setView([-23.561, -46.655], 14);
			L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
				attribution: "&copy; OpenStreetMap contributors",
				maxZoom: 19,
			}).addTo(map);

			let origemMarker = null;
			let destinoMarker = null;
			let rota = null;

			const campoOrigem = document.getElementById("origem");
			const campoDestino = document.getElementById("destino");
			const botaoRota = document.getElementById("btnRota");

			// --- obter localiza√ß√£o atual ---
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition((pos) => {
					const { latitude, longitude } = pos.coords;
					map.setView([latitude, longitude], 15);
					origemMarker = L.marker([latitude, longitude]).addTo(map).bindPopup("Voc√™ est√° aqui!").openPopup();
					campoOrigem.placeholder = "Localiza√ß√£o atual detectada";
				});
			}

			// --- busca gen√©rica (geocoding) ---
			async function buscarEndereco(endereco) {
				const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(endereco)}+S√£o Paulo,Brasil`;
				const resp = await fetch(url);
				const dados = await resp.json();
				return dados.length ? dados[0] : null;
			}

			// --- tra√ßar rota ---
			botaoRota.addEventListener("click", async () => {
				const origem = campoOrigem.value.trim();
				const destino = campoDestino.value.trim();
				if (!destino && !origem) return alert("Informe pelo menos o destino!");

				let pontoOrigem = null;
				let pontoDestino = null;

				// origem: localiza√ß√£o atual ou texto
				if (origemMarker) {
					pontoOrigem = origemMarker.getLatLng();
				} else if (origem) {
					const o = await buscarEndereco(origem);
					if (!o) return alert("Origem n√£o encontrada.");
					pontoOrigem = L.latLng(o.lat, o.lon);
					if (origemMarker) map.removeLayer(origemMarker);
					origemMarker = L.marker(pontoOrigem).addTo(map).bindPopup("Origem");
				}

				// destino
				if (destino) {
					const d = await buscarEndereco(destino);
					if (!d) return alert("Destino n√£o encontrado.");
					pontoDestino = L.latLng(d.lat, d.lon);
					if (destinoMarker) map.removeLayer(destinoMarker);
					destinoMarker = L.marker(pontoDestino).addTo(map).bindPopup("Destino");
				}

				if (rota) map.removeLayer(rota);

				if (pontoOrigem && pontoDestino) {
					const pontos = [pontoOrigem, pontoDestino];
					rota = L.polyline(pontos, { color: "blue", weight: 4 }).addTo(map);
					map.fitBounds(rota.getBounds());
				} else {
					alert("N√£o foi poss√≠vel determinar os pontos da rota.");
				}
			});

			// --- sidebar ---
			const sidebar = document.getElementById("sidebar");
			document.getElementById("menuBtn").addEventListener("click", () => {
				sidebar.classList.toggle("active");
			});
		</script>
	</body>
</html>
